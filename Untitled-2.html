<!DOCTYPE html>
<html lang="sl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Administracija uporabnikov</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: linear-gradient(135deg, #6b7280 0%, #4b5563 50%, #374151 100%);
        min-height: 100vh;
        padding: 20px;
        line-height: 1.6;
        color: #1a202c;
      }

      .container {
        max-width: 900px;
        margin: 0 auto;
        background: rgba(255, 255, 255, 0.98);
        border-radius: 24px;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15);
        backdrop-filter: blur(20px);
        overflow: hidden;
      }

      .header {
        background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
        color: white;
        padding: 40px 32px;
        text-align: center;
        position: relative;
      }

      .header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="white" opacity="0.1"/><circle cx="75" cy="75" r="1" fill="white" opacity="0.1"/><circle cx="50" cy="10" r="0.5" fill="white" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
        opacity: 0.3;
      }

      .header h1 {
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 8px;
        position: relative;
        z-index: 1;
      }

      .header p {
        font-size: 1.1rem;
        opacity: 0.9;
        font-weight: 400;
        position: relative;
        z-index: 1;
      }

      .content {
        padding: 40px 32px;
      }

      .auth-check {
        background: linear-gradient(135deg, #fed7d7 0%, #feb2b2 100%);
        color: #c53030;
        padding: 16px 20px;
        border-radius: 12px;
        margin-bottom: 32px;
        display: flex;
        align-items: center;
        gap: 12px;
        font-weight: 500;
        border-left: 4px solid #e53e3e;
      }

      .form-section {
        margin-bottom: 32px;
      }

      .form-group {
        margin-bottom: 24px;
      }

      .form-label {
        display: block;
        font-weight: 600;
        color: #2d3748;
        margin-bottom: 8px;
        font-size: 0.95rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .select-wrapper {
        position: relative;
      }

      .select-wrapper::after {
        content: '\f107';
        font-family: 'Font Awesome 6 Free';
        font-weight: 900;
        position: absolute;
        right: 16px;
        top: 50%;
        transform: translateY(-50%);
        color: #718096;
        pointer-events: none;
        font-size: 1.1rem;
      }

      select {
        width: 100%;
        padding: 16px 20px;
        border: 2px solid #e2e8f0;
        border-radius: 12px;
        font-size: 1rem;
        font-weight: 500;
        background: white;
        color: #2d3748;
        transition: all 0.3s ease;
        appearance: none;
        cursor: pointer;
      }

      select:focus {
        outline: none;
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        transform: translateY(-1px);
      }

      select:hover {
        border-color: #cbd5e0;
      }

      .access-display {
        background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
        color: white;
        padding: 24px;
        border-radius: 16px;
        margin: 32px 0;
        box-shadow: 0 10px 25px rgba(72, 187, 120, 0.2);
        position: relative;
        overflow: hidden;
      }

      .access-display::before {
        content: '\f023';
        font-family: 'Font Awesome 6 Free';
        font-weight: 900;
        position: absolute;
        right: 20px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 3rem;
        opacity: 0.1;
      }

      .access-display h3 {
        font-size: 1.1rem;
        font-weight: 600;
        margin-bottom: 12px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .access-display h3::before {
        content: '\f058';
        font-family: 'Font Awesome 6 Free';
        font-weight: 900;
      }

      .access-controls {
        background: #f7fafc;
        padding: 32px;
        border-radius: 20px;
        margin-top: 32px;
        border: 1px solid #e2e8f0;
      }

      .controls-header {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 24px;
        padding-bottom: 16px;
        border-bottom: 2px solid #e2e8f0;
      }

      .controls-header h3 {
        font-size: 1.3rem;
        font-weight: 600;
        color: #2d3748;
      }

      .controls-header i {
        color: #3b82f6;
        font-size: 1.4rem;
      }

      .checkbox-group {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin: 24px 0;
      }

      .checkbox-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 16px;
        background: white;
        border-radius: 12px;
        border: 2px solid #e2e8f0;
        transition: all 0.3s ease;
        cursor: pointer;
      }

      .checkbox-item:hover {
        border-color: #3b82f6;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(59, 130, 246, 0.1);
      }

      .checkbox-item input[type="checkbox"] {
        width: 20px;
        height: 20px;
        accent-color: #3b82f6;
        cursor: pointer;
      }

      .checkbox-item label {
        font-weight: 500;
        color: #2d3748;
        cursor: pointer;
        flex: 1;
      }

      .button-group {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 16px;
        margin-top: 32px;
      }

      .btn {
        padding: 16px 24px;
        border: none;
        border-radius: 12px;
        font-weight: 600;
        font-size: 0.95rem;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        position: relative;
        overflow: hidden;
      }

      .btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
        transition: left 0.5s;
      }

      .btn:hover::before {
        left: 100%;
      }

      .btn-primary {
        background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
        color: white;
        box-shadow: 0 4px 15px rgba(72, 187, 120, 0.3);
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(72, 187, 120, 0.4);
      }

      .btn-danger {
        background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
        color: white;
        box-shadow: 0 4px 15px rgba(245, 101, 101, 0.3);
      }

      .btn-danger:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(245, 101, 101, 0.4);
      }

      .message {
        padding: 16px 20px;
        border-radius: 12px;
        margin-top: 20px;
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 12px;
        animation: slideIn 0.3s ease;
      }

      .message.success {
        background: linear-gradient(135deg, #c6f6d5 0%, #9ae6b4 100%);
        color: #22543d;
        border-left: 4px solid #48bb78;
      }

      .message.error {
        background: linear-gradient(135deg, #fed7d7 0%, #feb2b2 100%);
        color: #c53030;
        border-left: 4px solid #e53e3e;
      }

      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @media (max-width: 768px) {
        body {
          padding: 16px;
        }

        .container {
          border-radius: 16px;
        }

        .header {
          padding: 32px 24px;
        }

        .header h1 {
          font-size: 2rem;
        }

        .content {
          padding: 24px;
        }

        .checkbox-group {
          grid-template-columns: 1fr;
        }

        .button-group {
          grid-template-columns: 1fr;
        }

        .access-controls {
          padding: 24px;
        }
      }

      @media (max-width: 480px) {
        .header h1 {
          font-size: 1.75rem;
        }

        .content {
          padding: 20px;
        }

        .access-controls {
          padding: 20px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1><i class="fas fa-users-cog"></i> Administracija uporabnikov</h1>
        <p>Upravljajte dostope in dovoljenja za projekte</p>
      </div>

      <div class="content">
        <div id="authCheck" class="auth-check" style="display: none;">
          <i class="fas fa-exclamation-triangle"></i>
          <span>Dostop zavrnjen. Niste administrator.</span>
        </div>

        <div id="adminPanel" style="display: none;">
          <div class="form-section">
            <div class="form-group">
              <label for="userSelect" class="form-label">
                <i class="fas fa-user"></i> Izberi uporabnika
              </label>
              <div class="select-wrapper">
                <select id="userSelect"></select>
              </div>
            </div>

            <div class="form-group">
              <label for="projectSelect" class="form-label">
                <i class="fas fa-project-diagram"></i> Izberi projekt
              </label>
              <div class="select-wrapper">
                <select id="projectSelect"></select>
              </div>
            </div>
          </div>

          <div id="accessDisplay" class="access-display" style="display: none;">
            <h3>Trenutni dostop</h3>
            <div id="accessInfo"></div>
          </div>
          
          <div id="accessControls" class="access-controls" style="display: none;">
            <div class="controls-header">
              <i class="fas fa-shield-alt"></i>
              <h3>Nastavi dostop za <span id="selectedUser"></span> na projekt <span id="selectedProject"></span></h3>
            </div>
            
            <div class="checkbox-group">
              <div class="checkbox-item">
                <input type="checkbox" id="readAccess">
                <label for="readAccess">
                  <i class="fas fa-eye"></i> Ogled (read)
                </label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="writeAccess">
                <label for="writeAccess">
                  <i class="fas fa-edit"></i> Spreminjanje (write)
                </label>
              </div>
            </div>
            
            <div class="button-group">
              <button id="saveAccess" class="btn btn-primary">
                <i class="fas fa-save"></i> Shrani dostop
              </button>
              <button id="removeAccess" class="btn btn-danger">
                <i class="fas fa-trash"></i> Odstrani dostop
              </button>
            </div>
            
            <div id="message"></div>
          </div>
        </div>
      </div>
    </div>

    <script>
      const users = [
        { id: 1, name: "Lan", email: "lan@sl-king.com" },
        { id: 2, name: "Haris", email: "haris@sl-king.com" },
        { id: 3, name: "Djana", email: "djana@sl-king.com" },
        { id: 4, name: "Davor", email: "davor@sl-king.com" },
      ];

      const projects = [
        { id: 1, name: "Sv. Tomaž" },
        { id: 2, name: "Žužemberk" },
        { id: 4, name: "Šentrupert" },
        { id: 5, name: "Mirna" },
        { id: 6, name: "Mokronog" },
      ];

      let accessLinks = [
        { user_id: 1, project_id: 1, access: ["r"] },
        { user_id: 1, project_id: 4, access: ["r", "w"] },
        { user_id: 2, project_id: 2, access: ["r"] },
        { user_id: 3, project_id: 6, access: ["r", "w"] },
        { user_id: 4, project_id: 5, access: ["r"] },
        { user_id: 4, project_id: 1, access: ["r", "w"] },
      ];

      const adminEmails = ["lan@sl-king.com"];
      const currentEmail = "lan@sl-king.com"; // simulacija prijavljenega uporabnika

      const userSelect = document.getElementById("userSelect");
      const projectSelect = document.getElementById("projectSelect");
      const accessDisplay = document.getElementById("accessDisplay");
      const accessInfo = document.getElementById("accessInfo");
      const authCheck = document.getElementById("authCheck");
      const adminPanel = document.getElementById("adminPanel");
      const accessControls = document.getElementById("accessControls");
      const selectedUserSpan = document.getElementById("selectedUser");
      const selectedProjectSpan = document.getElementById("selectedProject");
      const readAccessCheckbox = document.getElementById("readAccess");
      const writeAccessCheckbox = document.getElementById("writeAccess");
      const saveAccessBtn = document.getElementById("saveAccess");
      const removeAccessBtn = document.getElementById("removeAccess");
      const messageDiv = document.getElementById("message");

      if (!adminEmails.includes(currentEmail)) {
        authCheck.style.display = "flex";
      } else {
        adminPanel.style.display = "block";

        users.forEach((user) => {
          const option = document.createElement("option");
          option.value = user.id;
          option.textContent = user.name;
          userSelect.appendChild(option);
        });

        projects.forEach((project) => {
          const option = document.createElement("option");
          option.value = project.id;
          option.textContent = project.name;
          projectSelect.appendChild(option);
        });

        function updateAccess() {
          const userId = parseInt(userSelect.value);
          const projectId = parseInt(projectSelect.value);
          const link = accessLinks.find(
            (entry) =>
              entry.user_id === userId && entry.project_id === projectId
          );

          // Update display
          if (link && link.access.length) {
            const accessText = link.access
              .map((a) =>
                a === "r" ? '<i class="fas fa-eye"></i> Ogled (read)' : '<i class="fas fa-edit"></i> Spreminjanje (write)'
              )
              .join("<br>");
            accessInfo.innerHTML = accessText;
            accessDisplay.style.display = "block";
          } else {
            accessInfo.innerHTML = '<i class="fas fa-ban"></i> Brez dostopa';
            accessDisplay.style.display = "block";
          }

          // Update controls
          const selectedUser = users.find(u => u.id === userId);
          const selectedProject = projects.find(p => p.id === projectId);
          
          selectedUserSpan.textContent = selectedUser ? selectedUser.name : '';
          selectedProjectSpan.textContent = selectedProject ? selectedProject.name : '';
          
          // Update checkboxes
          readAccessCheckbox.checked = link && link.access.includes("r");
          writeAccessCheckbox.checked = link && link.access.includes("w");
          
          accessControls.style.display = "block";
          messageDiv.innerHTML = "";
        }

        function showMessage(text, type = 'success') {
          messageDiv.innerHTML = `
            <div class="message ${type}">
              <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
              <span>${text}</span>
            </div>
          `;
          
          setTimeout(() => {
            messageDiv.innerHTML = "";
          }, 4000);
        }

        function saveAccess() {
          const userId = parseInt(userSelect.value);
          const projectId = parseInt(projectSelect.value);
          const newAccess = [];
          
          if (readAccessCheckbox.checked) newAccess.push("r");
          if (writeAccessCheckbox.checked) newAccess.push("w");
          
          // Remove existing access for this user-project combination
          accessLinks = accessLinks.filter(
            link => !(link.user_id === userId && link.project_id === projectId)
          );
          
          // Add new access if any permissions are selected
          if (newAccess.length > 0) {
            accessLinks.push({
              user_id: userId,
              project_id: projectId,
              access: newAccess
            });
          }
          
          showMessage("Dostop uspešno posodobljen!", "success");
          updateAccess();
        }

        function removeAccess() {
          const userId = parseInt(userSelect.value);
          const projectId = parseInt(projectSelect.value);
          
          // Remove access for this user-project combination
          accessLinks = accessLinks.filter(
            link => !(link.user_id === userId && link.project_id === projectId)
          );
          
          showMessage("Dostop uspešno odstranjen!", "success");
          updateAccess();
        }

        userSelect.addEventListener("change", updateAccess);
        projectSelect.addEventListener("change", updateAccess);
        saveAccessBtn.addEventListener("click", saveAccess);
        removeAccessBtn.addEventListener("click", removeAccess);
        
        // Initialize with first user and project
        updateAccess();
      }
    </script>
  </body>
</html>
